<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .modal-enter-active, .modal-leave-active { transition: opacity 0.3s ease; }
        .modal-enter-from, .modal-leave-to { opacity: 0; }
        .toast-enter-active { animation: bounce-in 0.5s; }
        .toast-leave-active { transition: all 0.3s ease; opacity: 0; transform: translateY(-100%); }
        @keyframes bounce-in {
            0% { transform: translateY(-100%) translateX(-50%); opacity: 0; }
            50% { transform: translateY(20%) translateX(-50%); opacity: 1; }
            100% { transform: translateY(0) translateX(-50%); }
        }
        /* Mobile-first A4 adjustment */
        .A4 { 
            background: white; 
            width: 100%; 
            max-width: 210mm; 
            padding: 10mm; 
            margin: 20px auto; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            overflow-x: auto; /* Allow scroll if content is too wide */
        }
        @media print {
            @page { size: A4; margin: 0; }
            body { margin: 0; padding: 0; background-color: white; }
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            .A4 { width: 210mm; min-height: 297mm; margin: 0; padding: 10mm !important; box-shadow: none; border: none; page-break-after: auto; overflow: visible; }
            ::-webkit-scrollbar { display: none; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 text-sm md:text-base">

<div id="app" class="relative min-h-screen">

    <div v-if="!session" class="min-h-screen flex items-center justify-center bg-blue-900 p-4">
        <div class="bg-white p-6 md:p-8 rounded-lg shadow-lg w-full max-w-sm">
            <h2 class="text-2xl font-bold mb-4 text-center text-blue-800">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
            <form @submit.prevent="handleLogin">
                <input v-model="loginData.email" type="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="w-full p-2 mb-3 border rounded" required>
                <input v-model="loginData.password" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-2 mb-3 border rounded" required>
                <button type="submit" :disabled="isLoading" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed">
                    {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...' : 'Login' }}
                </button>
            </form>
        </div>
    </div>

    <div v-else>
        <nav class="bg-white shadow p-4 mb-4 flex flex-col md:flex-row justify-between items-center no-print gap-4 md:gap-0">
            <div class="font-bold text-xl text-blue-800 text-center md:text-left">{{ provider.org_name || 'Printing System' }}</div>
            <div class="flex flex-col md:flex-row gap-4 items-center w-full md:w-auto">
                <div class="flex items-center gap-2 justify-center md:justify-start">
                    <span class="font-bold text-gray-700">{{ userProfile.display_name }}</span>
                    <span class="text-sm text-gray-500">({{ userProfile.role }})</span>
                    <button @click="editDisplayName" class="text-gray-400 hover:text-blue-600" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠">‚úèÔ∏è</button>
                </div>
                <div class="hidden md:block h-6 w-px bg-gray-300 mx-2"></div>
                <button @click="handleLogout" class="text-red-500 hover:text-red-700 w-full md:w-auto text-center border md:border-none p-2 md:p-0 rounded">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
            </div>
        </nav>

        <div v-if="currentPage === 'dashboard'" class="container mx-auto p-4">
            <h2 class="text-2xl font-bold mb-6 text-center md:text-left">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                <div @click="goToOrder" class="bg-white p-6 rounded shadow hover:shadow-lg cursor-pointer border-l-4 border-blue-500">
                    <h3 class="text-xl font-bold">üìù ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</h3>
                    <p class="text-gray-500">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</p>
                </div>
                <div @click="fetchHistory" class="bg-white p-6 rounded shadow hover:shadow-lg cursor-pointer border-l-4 border-green-500">
                    <h3 class="text-xl font-bold">üìÇ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</h3>
                    <p class="text-gray-500">‡∏î‡∏π‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤</p>
                </div>

                <div v-if="can('manage_stock')" @click="currentPage = 'inventory'; fetchMaterials()" class="bg-white p-6 rounded shadow hover:shadow-lg cursor-pointer border-l-4 border-teal-500">
                    <h3 class="text-xl font-bold">üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏™‡∏î‡∏∏</h3>
                    <p class="text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å / ‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢</p>
                </div>

                <div v-if="isAdmin" @click="goToCustomers" class="bg-white p-6 rounded shadow hover:shadow-lg cursor-pointer border-l-4 border-yellow-500">
                    <h3 class="text-xl font-bold">üë• ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
                    <p class="text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</p>
                </div>
                <div v-if="isAdmin" @click="goToServices" class="bg-white p-6 rounded shadow hover:shadow-lg cursor-pointer border-l-4 border-purple-500">
                    <h3 class="text-xl font-bold">üí∞ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                    <p class="text-gray-500">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
                </div>
            </div>
        </div>

        <div v-if="currentPage === 'order'" class="container mx-auto p-4">
            <button @click="currentPage = 'dashboard'" class="mb-4 text-gray-500 hover:text-gray-800 no-print flex items-center gap-1">
                <span>&larr;</span> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
            
            <div v-if="!showPreview" class="bg-white p-4 md:p-6 rounded shadow">
                <h2 class="text-xl font-bold mb-4 border-b pb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</h2>
                <div class="mb-4 flex flex-col sm:flex-row gap-4">
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" v-model="orderForm.customerType" value="general"> ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</label>
                    <label class="flex items-center gap-2 cursor-pointer"><input type="radio" v-model="orderForm.customerType" value="corporate"> ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</label>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div v-if="orderForm.customerType === 'corporate'">
                        <label class="block text-sm font-bold">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</label>
                        <select v-model="orderForm.selectedCustomer" @change="fillCustomerInfo" class="w-full border p-2 rounded">
                            <option :value="null">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                            <option v-for="c in customers" :value="c">{{ c.name }}</option>
                        </select>
                    </div>
                    <div><label class="block text-sm font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label><input v-model="orderForm.customerName" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold">‡∏™‡∏≤‡∏Ç‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</label><input v-model="orderForm.branch" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô/‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label><input v-model="orderForm.eventName" type="text" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</label><input v-model="orderForm.eventDate" type="date" class="w-full border p-2 rounded"></div>
                </div>

                <h3 class="font-bold mt-6 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ó‡∏≥ ({{ orderForm.items.length }}/30)</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm border-collapse border min-w-[600px]">
                       <thead>
                            <tr class="bg-gray-200">
                                <th class="border p-2">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th><th class="border p-2 w-16">‡∏Å‡∏ß‡πâ‡∏≤‡∏á</th><th class="border p-2 w-16">‡∏™‡∏π‡∏á</th><th class="border p-2 w-16">‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                                <th class="border p-2 w-16">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="border p-2 w-24">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th class="border p-2 w-24">‡∏£‡∏ß‡∏°</th><th class="border p-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th class="border p-2 w-10">‡∏•‡∏ö</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item, idx) in orderForm.items" :key="idx">
                                <td class="border p-1">
                                    <select v-model="item.service" @change="updatePrice(item)" class="w-full p-1 border">
                                        <option v-for="s in services" :value="s">{{ s.service_name }}</option>
                                        <option :value="{service_name:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ', unit_price:0}">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                                    </select>
                                    <input v-if="item.service.service_name === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'" v-model="item.customName" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠" class="w-full mt-1 p-1 border text-xs">
                                </td>
                                <td class="border p-1"><input type="number" v-model="item.w" @input="calcRow(item, 'size')" class="w-full p-1 border"></td>
                                <td class="border p-1"><input type="number" v-model="item.h" @input="calcRow(item, 'size')" class="w-full p-1 border"></td>
                                <td class="border p-1"><select v-model="item.unit" @change="calcRow(item, 'size')" class="p-1 border w-full"><option value="cm">‡∏ã‡∏°.</option><option value="m">‡∏°.</option></select></td>
                                <td class="border p-1"><input type="number" v-model="item.qty" @input="calcRow(item, 'qty')" class="w-full p-1 border"></td>
                                <td class="border p-1"><input type="number" v-model="item.price" :readonly="!isAdmin" @input="calcRow(item, 'manual')" class="w-full p-1 border bg-gray-50 font-bold text-blue-600 text-right"></td>
                                <td class="border p-1 text-right">{{ formatCurrency(item.total) }}</td>
                                <td class="border p-1"><input type="text" v-model="item.note" class="w-full p-1 border"></td>
                                <td class="border p-1 text-center"><button @click="removeItem(idx)" class="text-red-500 font-bold hover:bg-red-100 px-2 rounded">x</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <button v-if="orderForm.items.length < 30" @click="addItem" class="mt-2 bg-green-500 text-white px-4 py-2 rounded text-sm hover:bg-green-600 w-full sm:w-auto">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                <div class="mt-8 flex flex-col sm:flex-row justify-end gap-4 border-t pt-4">
                    <button @click="resetOrder" class="bg-gray-300 text-gray-800 px-6 py-2 rounded hover:bg-gray-400 w-full sm:w-auto">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="preparePreview" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 shadow w-full sm:w-auto">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö / ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</button>
                </div>
            </div>

            <div v-if="showPreview" class="relative">
                <div class="A4 mx-auto">
                    <div class="text-center mb-6">
                        <img v-if="provider.logo_url" :src="provider.logo_url" class="h-16 mx-auto mb-2">
                        <h1 class="text-xl md:text-2xl font-bold">{{ provider.org_name }}</h1>
                        <p class="text-xs md:text-sm">{{ provider.address }} | ‡πÇ‡∏ó‡∏£: {{ provider.phone }} | ‡πÄ‡∏•‡∏Ç‡∏†‡∏≤‡∏©‡∏µ: {{ provider.tax_id }}</p>
                        <div class="mt-4 text-lg md:text-xl font-bold border-2 border-black inline-block px-4 py-1">‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô / ‡πÉ‡∏ö‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</div>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-between mb-4 text-sm gap-4">
                        <div class="w-full sm:w-2/3">
                            <p><strong>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</strong> {{ orderForm.customerName }}</p>
                            <p><strong>‡∏™‡∏≤‡∏Ç‡∏≤/‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> {{ orderForm.branch }}</p>
                            <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô:</strong> {{ orderForm.eventName }}</p>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:</strong> {{ formatDate(orderForm.eventDate) }}</p>
                        </div>
                        <div class="w-full sm:w-1/3 text-left sm:text-right">
                            <p><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> {{ generatedJobId }}</p>
                            <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> {{ formatDate(new Date()) }}</p>
                            <p><strong>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô:</strong> {{ userProfile.display_name }}</p>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-black text-sm mb-6 min-w-[500px]">
                            <thead>
                                <tr class="bg-gray-200">
                                    <th class="border border-black p-2 w-10">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th class="border border-black p-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th><th class="border border-black p-2 w-24">‡∏Ç‡∏ô‡∏≤‡∏î (‡∏°.)</th>
                                    <th class="border border-black p-2 w-16">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th class="border border-black p-2 w-24">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th class="border border-black p-2 w-24">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(item, idx) in orderForm.items" :key="idx">
                                    <td class="border border-black p-2 text-center">{{ idx + 1 }}</td>
                                    <td class="border border-black p-2">
                                        {{ item.service.service_name === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ? item.customName : item.service.service_name }}
                                        <div class="text-xs text-gray-500">{{ item.note }}</div>
                                    </td>
                                    <td class="border border-black p-2 text-center">{{ (item.unit === 'cm' ? item.w/100 : item.w) }} x {{ (item.unit === 'cm' ? item.h/100 : item.h) }}</td>
                                    <td class="border border-black p-2 text-center">{{ item.qty }}</td>
                                    <td class="border border-black p-2 text-right">{{ formatCurrency(item.price) }}</td>
                                    <td class="border border-black p-2 text-right">{{ formatCurrency(item.total) }}</td>
                                </tr>
                                <tr v-for="n in (10 - orderForm.items.length)" :key="'empty'+n" v-if="orderForm.items.length < 10">
                                    <td class="border border-black p-2">&nbsp;</td><td class="border border-black p-2"></td><td class="border border-black p-2"></td>
                                    <td class="border border-black p-2"></td><td class="border border-black p-2"></td><td class="border border-black p-2"></td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr class="font-bold bg-gray-100">
                                    <td colspan="5" class="border border-black p-2 text-right">‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô</td>
                                    <td class="border border-black p-2 text-right">{{ formatCurrency(grandTotal) }} ‡∏ö‡∏≤‡∏ó</td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-between mt-12 text-center px-4 sm:px-8 gap-8 sm:gap-0">
                        <div>
                            <p class="mb-8 border-b border-black w-48 mx-auto"></p> <p class="font-bold text-lg">{{ orderForm.creatorName }}</p>
                            <p class="text-sm">(‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô)</p>
                        </div>
                        <div>
                            <p class="mb-8 border-b border-black w-48 mx-auto"></p> <p class="font-bold text-lg">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                            <p class="text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ...../...../..........</p>
                        </div>
                    </div>
                </div>
                <div class="fixed bottom-0 left-0 w-full bg-white p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] flex flex-col sm:flex-row justify-center gap-4 no-print border-t z-10">
                    <button @click="showPreview = false" class="bg-gray-500 text-white px-6 py-2 rounded shadow w-full sm:w-auto">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    <button onclick="window.print()" class="bg-purple-600 text-white px-6 py-2 rounded shadow w-full sm:w-auto">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå / PDF</button>
                    <button @click="submitOrder" :disabled="isLoading" v-if="!isHistoryView" class="bg-green-600 text-white px-6 py-2 rounded font-bold shadow hover:bg-green-700 w-full sm:w-auto disabled:opacity-50">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</button>
                    <button @click="currentPage='dashboard'" v-if="isHistoryView" class="bg-gray-800 text-white px-6 py-2 rounded shadow w-full sm:w-auto">‡∏õ‡∏¥‡∏î</button>
                </div>
                <div class="h-32 no-print"></div>
            </div>
        </div>

        <div v-if="currentPage === 'history'" class="container mx-auto p-4">
            
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <div class="w-full md:w-auto">
                    <button @click="currentPage = 'dashboard'" class="mb-2 text-gray-500 hover:text-gray-800 flex items-center gap-1">
                        &larr; ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
                    </button>
                    <h2 class="text-2xl font-bold">üìÇ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô</h2>
                </div>

                <div class="flex flex-col md:flex-row gap-2 w-full md:w-auto bg-white p-2 rounded shadow-sm border">
                    <div class="relative w-full md:w-64">
                        <span class="absolute left-3 top-2.5 text-gray-400">üîç</span>
                        <input v-model="searchQuery" type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô / ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..." 
                               class="pl-9 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 w-full">
                    </div>

                    <select v-model="statusFilter" class="py-2 px-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-300 cursor-pointer bg-white w-full md:w-auto">
                        <option value="">Showing: ‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                        <option v-for="(info, key) in statusOptions" :key="key" :value="key">
                            {{ info.label }}
                        </option>
                    </select>
                </div>
            </div>

            <div class="bg-white rounded shadow overflow-hidden"> 
                <div class="overflow-x-auto">
                    <table class="w-full text-sm min-w-[800px]">
                        <thead>
                            <tr class="bg-blue-100 text-left">
                                <th class="p-3">ID ‡∏á‡∏≤‡∏ô</th> <th class="p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th> <th class="p-3">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th> <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</th>
                                <th class="p-3">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th> <th class="p-3">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th> <th class="p-3">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="job in paginatedHistory" :key="job.job_id" class="border-b hover:bg-gray-50">
                                <td class="p-3 font-mono font-bold text-blue-600">{{ job.job_id }}</td>
                                <td class="p-3">{{ formatDate(job.created_at) }}</td>
                                <td class="p-3">{{ job.customer_name }}</td>
                                <td class="p-3">{{ job.event_name }}</td>
                                <td class="p-3">{{ formatCurrency(job.total_price) }}</td>
                                <td class="p-3">
                                    <span v-if="statusOptions[job.status]" :class="statusOptions[job.status].class" class="px-2 py-1 rounded-full text-xs font-bold border border-opacity-20 whitespace-nowrap">{{ statusOptions[job.status].label }}</span>
                                    <span v-else class="text-gray-400 text-xs">{{ job.status }}</span>
                                </td>
                                <td class="p-3">
                                    <div class="flex flex-wrap items-center gap-2">
                                        <button @click="viewJob(job)" class="bg-blue-50 text-blue-600 hover:bg-blue-100 border border-blue-200 px-3 py-1 rounded text-xs transition flex items-center gap-1">üìÑ ‡∏î‡∏π</button>
                                        <button @click="printJob(job)" class="bg-red-50 text-red-600 hover:bg-red-100 border border-red-200 px-3 py-1 rounded text-xs transition flex items-center gap-1">üñ®Ô∏è PDF</button>
                                        <button v-if="can('change_status')" @click="openStatusModal(job)" class="bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200 px-3 py-1 rounded text-xs transition flex items-center gap-1">‚úèÔ∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                                    </div>
                                </td>
                            </tr>
                            <tr v-if="paginatedHistory.length === 0">
                                <td colspan="7" class="p-8 text-center text-gray-500 bg-gray-50">
                                    ‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ jobHistory.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div v-if="totalPages > 1" class="bg-gray-50 border-t p-3 flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="text-xs text-gray-500 text-center sm:text-left">
                        ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ {{ currentPageNum }} ‡∏à‡∏≤‡∏Å {{ totalPages }} (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ filteredHistory.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <button @click="changePage(currentPageNum - 1)" :disabled="currentPageNum === 1"
                                class="px-3 py-1 rounded border bg-white hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                            &larr; ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        
                        <div class="flex items-center gap-1">
                            <span>‡∏´‡∏ô‡πâ‡∏≤</span>
                            <input type="number" v-model.number="currentPageNum" @change="changePage(currentPageNum)"
                                   min="1" :max="totalPages"
                                   class="w-12 text-center border rounded p-1 text-sm focus:ring-2 focus:ring-blue-300 outline-none">
                            <span>/ {{ totalPages }}</span>
                        </div>

                        <button @click="changePage(currentPageNum + 1)" :disabled="currentPageNum === totalPages"
                                class="px-3 py-1 rounded border bg-white hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ &rarr;
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentPage === 'customers'" class="container mx-auto p-4">
             <button @click="currentPage = 'dashboard'" class="mb-4 text-gray-500 hover:text-gray-800">&larr; ‡∏Å‡∏•‡∏±‡∏ö</button>
             <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                 <h2 class="text-2xl font-bold">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</h2>
                 <button @click="openCustomerModal()" class="bg-green-500 text-white px-4 py-2 rounded shadow w-full sm:w-auto">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</button>
             </div>
             <div class="bg-white shadow rounded p-4 overflow-x-auto">
                <table class="w-full text-sm min-w-[700px]">
                    <thead><tr class="bg-gray-100 text-left"><th class="p-3">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£</th><th class="p-3">‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ</th><th class="p-3">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th><th class="p-3">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th><th class="p-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                    <tbody>
                        <tr v-for="c in customers" :key="c.id" class="border-b hover:bg-gray-50">
                            <td class="p-3 font-bold text-blue-900">{{ c.name }}</td><td class="p-3 font-mono text-gray-600">{{ c.tax_id || '-' }}</td>
                            <td class="p-3 text-gray-600 max-w-xs truncate" :title="c.address">{{ c.address || '-' }}</td><td class="p-3">{{ c.phone }}</td>
                            <td class="p-3 text-center flex justify-center gap-2">
                                <button @click="openCustomerModal(c)" class="text-yellow-600 hover:text-yellow-800 bg-yellow-50 px-3 py-1 rounded border border-yellow-200">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                <button @click="deleteCustomer(c.id)" class="text-red-500 hover:text-red-700 bg-red-50 px-3 py-1 rounded border border-red-200">‡∏•‡∏ö</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div v-if="currentPage === 'services'" class="container mx-auto p-4">
             <button @click="currentPage = 'dashboard'" class="mb-4 text-gray-500 hover:text-gray-800">&larr; ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
             <h2 class="text-2xl font-bold mb-6">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</h2>
             <div class="bg-white p-6 rounded shadow mb-6 border-l-4 border-green-500">
                <h3 class="font-bold text-lg mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                <div class="flex flex-col md:flex-row gap-4 items-end">
                    <div class="w-full md:w-1/3"><label class="block text-sm text-gray-600 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label><input v-model="newService.name" type="text" class="w-full border p-2 rounded"></div>
                    <div class="w-full md:w-1/4"><label class="block text-sm text-gray-600 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label><input v-model="newService.price" type="number" class="w-full border p-2 rounded"></div>
                    <div class="w-full md:w-auto"><button @click="addService" :disabled="isLoading" class="bg-green-600 text-white px-6 py-2 rounded w-full md:w-auto disabled:opacity-50">+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button></div>
                </div>
            </div>
            <div class="bg-white shadow rounded overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm min-w-[500px]">
                        <thead class="bg-gray-100 text-gray-700"><tr><th class="p-3 text-left">‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</th><th class="border p-2">‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th><th class="p-3 text-center">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr v-for="s in services" :key="s.id" class="hover:bg-gray-50">
                                <td class="p-3 font-medium">{{ s.service_name }}</td>
                                <td class="p-3"><input type="number" :value="s.unit_price" @change="updateServicePrice(s, $event)" class="border p-1 w-24 rounded bg-gray-50 text-right"> ‡∏ö‡∏≤‡∏ó</td>
                                <td class="p-3 text-center"><button @click="deleteService(s.id)" class="text-red-500 hover:text-red-700 bg-red-50 px-3 py-1 rounded">‡∏•‡∏ö</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div v-if="currentPage === 'inventory'" class="container mx-auto p-4">
            <button @click="currentPage = 'dashboard'" class="mb-4 text-gray-500 hover:text-gray-800 flex items-center gap-1">&larr; ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
            
            <div class="flex flex-col md:flex-row justify-between items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold flex items-center gap-2">üì¶ ‡∏Ñ‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏™‡∏î‡∏∏</h2>
                
                </div>

            <div class="bg-white p-4 rounded shadow mb-6 space-y-4">
                <div class="flex border-b">
                    <button @click="activeTab = 'printing'" class="px-6 py-2 font-bold transition-colors border-b-2"
                        :class="activeTab === 'printing' ? 'border-blue-600 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700'">
                        üñ®Ô∏è ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏°‡πâ‡∏ß‡∏ô)
                    </button>
                    <button @click="activeTab = 'consumable'" class="px-6 py-2 font-bold transition-colors border-b-2"
                        :class="activeTab === 'consumable' ? 'border-blue-600 text-blue-600 bg-blue-50' : 'border-transparent text-gray-500 hover:text-gray-700'">
                        ‚úÇÔ∏è ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á (‡∏ä‡∏¥‡πâ‡∏ô/‡πÅ‡∏û‡πá‡∏Ñ)
                    </button>
                </div>

                <div class="flex flex-col md:flex-row justify-between items-center gap-4">
                    <div class="relative w-full md:w-96">
                        <span class="absolute left-3 top-2.5 text-gray-400">üîç</span>
                        <input v-model="matSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠, ‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠, ‡∏£‡∏´‡∏±‡∏™..." 
                               class="pl-9 pr-4 py-2 border rounded w-full focus:ring-2 focus:ring-blue-300 outline-none">
                    </div>

                    <div class="flex gap-2 w-full md:w-auto">
                        <div class="flex border rounded overflow-hidden">
                            <button @click="viewMode = 'grid'" class="px-3 py-2" :class="viewMode === 'grid' ? 'bg-blue-100 text-blue-700' : 'bg-white hover:bg-gray-50'" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î">
                                ‚¨õ Card
                            </button>
                            <div class="w-px bg-gray-300"></div>
                            <button @click="viewMode = 'table'" class="px-3 py-2" :class="viewMode === 'table' ? 'bg-blue-100 text-blue-700' : 'bg-white hover:bg-gray-50'" title="‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á">
                                ‚ò∞ Table
                            </button>
                        </div>

                        <button @click="currentPage = 'inventory_logs'; fetchLogs()" class="bg-gray-100 text-gray-700 px-4 py-2 rounded hover:bg-gray-200 border">
                            üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                        </button>
                        <button @click="openMatModal('add')" class="bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700 font-bold">
                            + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏
                        </button>
                    </div>
                </div>
            </div>

            <div v-if="viewMode === 'grid'" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
                <div v-for="mat in sortedMaterials" :key="mat.id" 
                    class="rounded-lg shadow border overflow-hidden flex flex-col relative transition-all hover:shadow-md"
                    :class="{
                        'bg-red-600 text-white border-red-700': mat.remaining_qty === 0, 
                        'bg-yellow-300 text-gray-900 border-yellow-400': mat.remaining_qty > 0 && mat.remaining_qty <= mat.min_alert,
                        'bg-white text-gray-800 border-gray-200': mat.remaining_qty > mat.min_alert
                    }">
                    
                    <div class="p-4 flex-grow flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <span class="px-2 py-1 rounded text-xs font-bold bg-opacity-20 bg-black backdrop-blur-sm">
                                {{ mat.category }}
                            </span>
                            <span class="text-xs opacity-70">{{ mat.type === 'roll' ? '‡∏°‡πâ‡∏ß‡∏ô' : (mat.type === 'piece' ? '‡∏ä‡∏¥‡πâ‡∏ô' : '‡πÅ‡∏û‡πá‡∏Ñ') }}</span>
                        </div>
                        <h3 class="font-bold text-lg mb-1">{{ mat.name }}</h3>
                        
                        <div class="text-xs mb-3 space-y-1 opacity-80">
                            <p v-if="mat.brand">üè∑Ô∏è {{ mat.brand }}</p>
                            <p v-if="mat.supplier">üè™ {{ mat.supplier }}</p>
                            <p v-if="mat.type === 'roll'">üìè ‡∏Å‡∏ß‡πâ‡∏≤‡∏á: {{ mat.width }} ‡∏°.</p>
                        </div>

                        <div class="mt-auto mb-2 pt-2 border-t border-black border-opacity-10 grid grid-cols-2 gap-2 text-xs text-center" 
                             :class="mat.remaining_qty === 0 ? 'text-white' : 'text-gray-600'">
                            <div class="bg-black bg-opacity-5 rounded p-1">
                                <div class="font-bold" :class="mat.remaining_qty === 0 ? '' : 'text-green-600'">IN: {{ (mat.total_in || 0).toLocaleString() }}</div>
                                <div class="opacity-70 text-[10px]">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏∞‡∏™‡∏°</div>
                            </div>
                            <div class="bg-black bg-opacity-5 rounded p-1">
                                <div class="font-bold" :class="mat.remaining_qty === 0 ? '' : 'text-red-600'">OUT: {{ (mat.total_out || 0).toLocaleString() }}</div>
                                <div class="opacity-70 text-[10px]">‡πÄ‡∏ö‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡∏™‡∏∞‡∏™‡∏°</div>
                            </div>
                        </div>
                        
                        <div class="flex items-end justify-between pt-2 border-t border-black border-opacity-10">
                            <div>
                                <p class="text-xs opacity-70">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                                <p class="text-2xl font-bold">
                                    {{ mat.remaining_qty.toLocaleString() }} <span class="text-sm font-normal">{{ mat.unit }}</span>
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-xs opacity-70">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</p>
                                <p class="font-mono">{{ mat.cost_per_unit }} ‡∏ö.</p>
                            </div>
                        </div>
                    </div>

                    <div class="p-2 border-t border-black border-opacity-10 flex gap-1 bg-black bg-opacity-5">
                        <button :disabled="isLoading" @click="openStockAction('IN', mat)" class="flex-1 bg-white text-green-700 py-1 rounded hover:bg-green-50 text-sm font-bold shadow-sm disabled:opacity-50">+ ‡∏£‡∏±‡∏ö</button>
                        <button :disabled="isLoading || mat.remaining_qty === 0" @click="openStockAction('OUT', mat)" class="flex-1 bg-white text-red-700 py-1 rounded hover:bg-red-50 text-sm font-bold shadow-sm disabled:opacity-50">- ‡πÄ‡∏ö‡∏¥‡∏Å</button>
                        <button :disabled="isLoading" @click="openMatModal('edit', mat)" class="w-8 flex items-center justify-center bg-white text-gray-600 rounded hover:bg-gray-50 shadow-sm disabled:opacity-50">‚öôÔ∏è</button>
                        <button :disabled="isLoading" @click="deleteMaterial(mat.id)" class="w-8 flex items-center justify-center bg-white text-red-500 rounded hover:bg-red-50 shadow-sm disabled:opacity-50">üóëÔ∏è</button>
                    </div>
                </div>
            </div>

            <div v-if="viewMode === 'table'" class="bg-white shadow rounded overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-100 text-gray-700 uppercase">
                            <tr>
                                <th class="p-3 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏</th>
                                <th class="p-3 text-left">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                <th class="p-3 text-right">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
                                <th class="p-3 text-center">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (In)</th>
                                <th class="p-3 text-center">‡πÄ‡∏ö‡∏¥‡∏Å‡πÉ‡∏ä‡πâ (Out)</th>
                                <th class="p-3 text-center">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                                <th class="p-3 text-center w-48">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            <tr v-for="mat in sortedMaterials" :key="mat.id" 
                                :class="{
                                    'bg-red-50': mat.remaining_qty === 0, 
                                    'bg-yellow-50': mat.remaining_qty > 0 && mat.remaining_qty <= mat.min_alert,
                                    'hover:bg-gray-50': mat.remaining_qty > mat.min_alert
                                }">
                                <td class="p-3">
                                    <div class="font-bold text-base" :class="{'text-red-600': mat.remaining_qty === 0}">{{ mat.name }}</div>
                                    <div class="text-xs text-gray-500">{{ mat.category }} | {{ mat.brand || '-' }}</div>
                                </td>
                                <td class="p-3 text-gray-600">
                                    <div v-if="mat.type === 'roll'">‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á {{ mat.width }} ‡∏°.</div>
                                    <div v-if="mat.supplier">‡∏£‡πâ‡∏≤‡∏ô: {{ mat.supplier }}</div>
                                    <div class="text-xs text-gray-400">{{ mat.details }}</div>
                                </td>
                                <td class="p-3 text-right font-mono">{{ mat.cost_per_unit }}</td>
                                
                                <td class="p-3 text-center text-green-600 font-bold">{{ (mat.total_in || 0).toLocaleString() }}</td>
                                <td class="p-3 text-center text-red-600 font-bold">{{ (mat.total_out || 0).toLocaleString() }}</td>
                                
                                <td class="p-3 text-center">
                                    <span class="text-lg font-bold px-3 py-1 rounded-full inline-block min-w-[80px]"
                                          :class="{
                                              'bg-red-600 text-white': mat.remaining_qty === 0,
                                              'bg-yellow-400 text-black': mat.remaining_qty > 0 && mat.remaining_qty <= mat.min_alert,
                                              'bg-gray-100 text-gray-800': mat.remaining_qty > mat.min_alert
                                          }">
                                        {{ mat.remaining_qty.toLocaleString() }}
                                    </span>
                                    <div class="text-xs text-gray-500 mt-1">{{ mat.unit }}</div>
                                </td>
                                <td class="p-3 text-center">
                                    <div class="flex justify-center gap-1">
                                        <button :disabled="isLoading" @click="openStockAction('IN', mat)" class="bg-green-100 text-green-700 hover:bg-green-200 px-3 py-1 rounded text-xs font-bold disabled:opacity-50">+ ‡∏£‡∏±‡∏ö</button>
                                        <button :disabled="isLoading || mat.remaining_qty === 0" @click="openStockAction('OUT', mat)" class="bg-red-100 text-red-700 hover:bg-red-200 px-3 py-1 rounded text-xs font-bold disabled:opacity-50">- ‡πÄ‡∏ö‡∏¥‡∏Å</button>
                                        <button :disabled="isLoading" @click="openMatModal('edit', mat)" class="text-gray-400 hover:text-blue-600 px-2 disabled:opacity-50">‚öôÔ∏è</button>
                                        <button :disabled="isLoading" @click="deleteMaterial(mat.id)" class="text-gray-400 hover:text-red-600 px-2 disabled:opacity-50">üóëÔ∏è</button>
                                    </div>
                                </td>
                            </tr>
                            <tr v-if="sortedMaterials.length === 0">
                                <td colspan="7" class="p-8 text-center text-gray-500">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ô‡∏µ‡πâ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div v-if="currentPage === 'inventory_logs'" class="container mx-auto p-4">
            <button @click="currentPage = 'inventory'" class="mb-4 text-gray-500 hover:text-gray-800">&larr; ‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏™‡∏î‡∏∏</button>
            <h2 class="text-2xl font-bold mb-6">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å-‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏™‡∏î‡∏∏</h2>

            <div class="flex flex-col md:flex-row gap-4 mb-4 items-center">
                <div class="flex flex-col md:flex-row gap-2 flex-1 w-full bg-white p-4 rounded shadow">
                    <input v-model="invSearch" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏..." class="border p-2 rounded flex-1">
                    
                    <select v-model="invCategoryFilter" class="border p-2 rounded w-full md:w-auto">
                        <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                        <option v-for="c in materialCategories" :value="c">{{ c }}</option>
                    </select>

                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-500 whitespace-nowrap">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                        <input type="month" v-model="invMonthFilter" class="border p-2 rounded w-full md:w-auto">
                    </div>
                </div>
                
                <button @click="exportLogsCSV" class="bg-green-600 text-white px-6 py-4 rounded shadow font-bold hover:bg-green-700 whitespace-nowrap w-full md:w-auto">
                    üì• Export CSV
                </button>
            </div>

            <div class="bg-white shadow rounded overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm min-w-[1000px]">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="p-3 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="p-3 text-left">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                                <th class="p-3 text-center">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                                <th class="p-3 text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                <th class="p-3 text-right">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)</th>
                                <th class="p-3 text-left">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                                <th class="p-3 text-left">‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="log in paginatedLogs" :key="log.id" class="border-b hover:bg-gray-50">
                                <td class="p-3">{{ formatDate(log.action_date) }}</td>
                                <td class="p-3 font-bold">
                                    {{ (materials || []).find(m => m.id === log.material_id)?.name || 'Unknown/Deleted' }}
                                </td>
                                <td class="p-3 text-center">
                                    <span v-if="log.action_type === 'IN'" class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs font-bold">‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</span>
                                    <span v-else-if="log.action_type === 'OUT'" class="bg-red-100 text-red-800 px-2 py-1 rounded text-xs font-bold">‡πÄ‡∏ö‡∏¥‡∏Å‡∏≠‡∏≠‡∏Å</span>
                                    <span v-else-if="log.action_type === 'CREATE'" class="bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</span>
                                    <span v-else-if="log.action_type === 'DELETE'" class="bg-gray-200 text-gray-800 px-2 py-1 rounded text-xs font-bold">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                                    <span v-else class="text-gray-500 text-xs">{{ log.action_type }}</span>
                                </td>
                                <td class="p-3 text-right font-mono text-lg" 
                                    :class="{
                                        'text-green-600': log.action_type === 'IN' || log.action_type === 'CREATE', 
                                        'text-red-600': log.action_type === 'OUT',
                                        'text-gray-400': log.action_type === 'DELETE'
                                    }">
                                    {{ log.action_type === 'IN' || log.action_type === 'CREATE' ? '+' : (log.action_type === 'DELETE' ? '' : '-') }}
                                    {{ (log.qty_change || 0).toLocaleString() }}
                                </td>
                                <td class="p-3 text-right font-bold">
                                    {{ 
                                        (
                                            (log.qty_change || 0) * ((materials || []).find(m => m.id === log.material_id)?.cost_per_unit || 0)
                                        ).toLocaleString() 
                                    }}
                                </td>
                                
                                <td class="p-3 text-gray-600">
                                    {{ log.note }}
                                    <div v-if="log.width_used" class="text-xs text-gray-400 mt-1">
                                        (‡∏Ç‡∏ô‡∏≤‡∏î: {{ log.length_used }}‡∏°. x {{ log.width_used }}‡∏°.)
                                    </div>
                                </td>
                                <td class="p-3">{{ log.action_by }}</td>
                            </tr>
                            <tr v-if="!paginatedLogs || paginatedLogs.length === 0">
                                <td colspan="7" class="p-8 text-center text-gray-500">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="p-4 border-t flex flex-col sm:flex-row justify-between items-center gap-4 bg-gray-50">
                    <div class="text-xs text-gray-500 text-center sm:text-left">
                        ‡πÅ‡∏™‡∏î‡∏á {{ paginatedLogs.length }} ‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ (filteredLogs || []).length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà {{ invLogPage }} / {{ totalLogPages }})
                    </div>
                    
                    <div class="flex items-center gap-2">
                        <button @click="changeLogPage(invLogPage - 1)" :disabled="invLogPage === 1" class="px-3 py-1 rounded border bg-white hover:bg-gray-100 disabled:opacity-50">
                            &larr; ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
                        </button>
                        
                        <div class="flex items-center gap-1">
                            <span>‡∏´‡∏ô‡πâ‡∏≤</span>
                            <input type="number" v-model.lazy="invLogPage" @change="changeLogPage(invLogPage)"
                                min="1" :max="totalLogPages"
                                class="w-16 text-center border rounded p-1 text-sm focus:ring-2 focus:ring-blue-300 outline-none">
                            <span>/ {{ totalLogPages }}</span>
                        </div>

                        <button @click="changeLogPage(invLogPage + 1)" :disabled="invLogPage === totalLogPages" class="px-3 py-1 rounded border bg-white hover:bg-gray-100 disabled:opacity-50">
                            ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ &rarr;
                        </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <transition name="modal">
        <div v-if="matModal.isOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6 max-h-[90vh] overflow-y-auto">
                <h3 class="text-xl font-bold mb-4 border-b pb-2">{{ matModal.mode === 'add' ? '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÉ‡∏´‡∏°‡πà' : '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ß‡∏±‡∏™‡∏î‡∏∏' }}</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="sm:col-span-2">
                        <label class="block text-sm font-bold mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏ *</label>
                        <input v-model="matModal.data.name" class="w-full border p-2 rounded" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏™‡∏î‡∏∏">
                    </div>

                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠ (Brand)</label>
                        <input v-model="matModal.data.brand" class="w-full border p-2 rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô 3M, Avery">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</label>
                        <input v-model="matModal.data.supplier" class="w-full border p-2 rounded" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡πâ‡∏≤‡∏ô A, Shopee">
                    </div>

                    <div class="sm:col-span-2">
                        <label class="block text-sm font-bold mb-1">‡∏™‡πÄ‡∏õ‡∏Ñ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</label>
                        <textarea v-model="matModal.data.details" rows="2" class="w-full border p-2 rounded" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ..."></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <select v-model="matModal.data.category" class="w-full border p-2 rounded">
                            <option v-for="c in materialCategories" :value="c">{{ c }}</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏ö</label>
                        <select v-model="matModal.data.type" class="w-full border p-2 rounded">
                            <option v-for="t in materialTypes" :value="t.id">{{ t.label }}</option>
                        </select>
                    </div>

                    <div v-if="matModal.data.type === 'roll'" class="sm:col-span-2 bg-blue-50 p-3 rounded border border-blue-200">
                        <label class="block text-sm font-bold mb-1 text-blue-800">‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á (‡πÄ‡∏°‡∏ï‡∏£)</label>
                        <input type="number" step="0.01" v-model="matModal.data.width" class="w-full border p-2 rounded">
                        <p class="text-xs text-blue-600 mt-1">* ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ô‡∏µ‡πâ‡∏Ñ‡∏π‡∏ì‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô ‡∏ï‡∏£.‡∏°.</p>
                    </div>

                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏à‡∏∏‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</label>
                        <input type="number" v-model="matModal.data.min_alert" class="w-full border p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ô‡∏±‡∏ö</label>
                        <input type="text" v-model="matModal.data.unit" 
                               class="w-full border p-2 rounded" 
                               :disabled="matModal.data.type === 'roll'"
                               placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏ß‡∏î, ‡∏Å‡∏•‡πà‡∏≠‡∏á, ‡∏≠‡∏±‡∏ô">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                        <input type="number" v-model="matModal.data.cost_per_unit" class="w-full border p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô</label>
                        <input type="number" v-model="matModal.data.remaining_qty" class="w-full border p-2 rounded bg-gray-50" :disabled="matModal.mode === 'edit'">
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button @click="matModal.isOpen = false" class="px-4 py-2 bg-gray-200 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="saveMaterial" :disabled="isLoading" class="px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50">
                        {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' }}
                    </button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="stockActionModal.isOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                <div class="flex justify-between items-center border-b pb-2 mb-4">
                    <h3 class="text-xl font-bold" :class="stockActionModal.type === 'IN' ? 'text-green-600' : 'text-red-600'">
                        {{ stockActionModal.type === 'IN' ? 'üì• ‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å' : '‚úÇÔ∏è ‡πÄ‡∏ö‡∏¥‡∏Å‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏™‡∏î‡∏∏' }}
                    </h3>
                    <span class="text-sm bg-gray-100 px-2 py-1 rounded">{{ stockActionModal.material.name }}</span>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="date" v-model="stockActionModal.data.date" class="w-full border p-2 rounded">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</label>
                        <input type="text" v-model="stockActionModal.data.user" class="w-full border p-2 rounded bg-gray-50" readonly>
                    </div>

                    <div v-if="stockActionModal.material.type === 'roll'" class="bg-yellow-50 p-4 rounded border border-yellow-200">
                        <label class="block text-sm font-bold mb-1 text-yellow-800">
                            {{ stockActionModal.type === 'IN' ? '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (‡πÄ‡∏°‡∏ï‡∏£)' : '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡πÉ‡∏ä‡πâ (‡πÄ‡∏°‡∏ï‡∏£)' }}
                        </label>
                        <input type="number" step="0.1" v-model="stockActionModal.data.length" class="w-full border p-2 rounded text-lg font-bold">
                        <p class="text-sm mt-2 text-gray-600">
                            ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì: {{ stockActionModal.data.length || 0 }} ‡∏°. x {{ stockActionModal.material.width }} ‡∏°. = 
                            <strong class="text-lg">{{ (stockActionModal.data.length * stockActionModal.material.width).toFixed(2) }}</strong> ‡∏ï‡∏£.‡∏°.
                        </p>
                    </div>
                    <div v-else>
                        <label class="block text-sm font-bold mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ({{ stockActionModal.material.unit }})</label>
                        <input type="number" v-model="stockActionModal.data.qty" class="w-full border p-2 rounded text-lg font-bold">
                    </div>

                    <div>
                        <label class="block text-sm font-bold mb-1">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</label>
                        <input type="text" v-model="stockActionModal.data.note" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°, ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö‡∏á‡∏≤‡∏ô Job-xxx" class="w-full border p-2 rounded">
                    </div>
                </div>

                <div class="mt-6 flex justify-end gap-3">
                    <button @click="stockActionModal.isOpen = false" class="px-4 py-2 bg-gray-200 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="submitStockAction" :disabled="isLoading" class="px-4 py-2 text-white rounded font-bold disabled:opacity-50"
                            :class="stockActionModal.type === 'IN' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'">
                        {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£' }}
                    </button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="customerModal.isOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                <h3 class="text-xl font-bold mb-4 border-b pb-2">{{ customerModal.data.id ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà' }}</h3>
                <div class="space-y-4">
                    <div><label class="block text-sm font-bold mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ / ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ *</label><input v-model="customerModal.data.name" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-1">‡πÄ‡∏•‡∏Ç‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏†‡∏≤‡∏©‡∏µ</label><input v-model="customerModal.data.tax_id" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-1">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input v-model="customerModal.data.phone" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold mb-1">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label><textarea v-model="customerModal.data.address" rows="3" class="w-full border p-2 rounded"></textarea></div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button @click="customerModal.isOpen = false" class="px-4 py-2 bg-gray-200 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="submitCustomerModal" :disabled="isLoading" class="px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50">
                        {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å' }}
                    </button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="statusModal.isOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
                <h3 class="text-xl font-bold mb-4">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</h3>
                <p class="mb-4 text-gray-600">Job ID: <span class="font-bold text-black">{{ statusModal.job.job_id }}</span></p>
                <div class="text-left mb-6">
                    <label class="block text-sm font-bold mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà:</label>
                    <select v-model="statusModal.currentStatus" class="w-full border p-2 rounded">
                        <option v-for="(info, key) in statusOptions" :value="key">{{ info.label }}</option>
                    </select>
                </div>
                <div class="flex justify-center gap-3">
                    <button @click="statusModal.isOpen = false" class="px-4 py-2 bg-gray-200 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="saveStatusChange" class="px-4 py-2 bg-blue-600 text-white rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="modal">
        <div v-if="confirmModal.isOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-sm p-6 text-center">
                <div class="text-5xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-lg font-bold mb-4">{{ confirmModal.message }}</h3>
                <div class="flex justify-center gap-3">
                    <button @click="confirmModal.isOpen = false" class="px-4 py-2 bg-gray-200 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button @click="handleConfirmAction" :disabled="isLoading" class="px-4 py-2 bg-blue-600 text-white rounded font-bold disabled:opacity-50">
                        {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô...' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' }}
                    </button>
                </div>
            </div>
        </div>
    </transition>

    <transition name="toast">
        <div v-if="toast.visible" class="fixed top-5 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded shadow-lg z-50 flex items-center gap-2 max-w-[90vw] text-center"
             :class="toast.type === 'error' ? 'bg-red-500 text-white' : 'bg-green-500 text-white'">
            <span v-if="toast.type === 'error'">‚ùå</span>
            <span v-else>‚úÖ</span>
            {{ toast.message }}
        </div>
    </transition>
	
	<transition name="modal">
        <div v-if="deviceLimitModal.isOpen" class="fixed inset-0 bg-black bg-opacity-80 z-[100] flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
                <div class="text-center mb-6">
                    <div class="text-5xl mb-2">üö´</div>
                    <h3 class="text-xl font-bold text-red-600">‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 2 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
                    <p class="text-gray-600 text-sm mt-2">
                        ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ <b>{{ userProfile.email }}</b> ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡πâ‡∏ß (2/2) <br>
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <b>"‡πÄ‡∏ï‡∏∞"</b> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏Å 1 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                    </p>
                </div>

                <div class="space-y-3 mb-6">
                    <div v-for="sess in deviceLimitModal.sessions" :key="sess.id" class="flex items-center justify-between p-3 border rounded bg-gray-50 hover:bg-gray-100">
                        <div>
                            <div class="font-bold text-gray-800">{{ sess.device_name || 'Unknown Device' }}</div>
                            <div class="text-xs text-gray-500">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: {{ formatDateTime(sess.last_active) }}</div>
                        </div>
                        <button @click="kickDevice(sess.id)" :disabled="isLoading" class="bg-red-500 hover:bg-red-600 text-white text-sm px-3 py-2 rounded shadow transition disabled:opacity-50">
                            {{ isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏∞...' : 'ü¶∂ ‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å' }}
                        </button>
                    </div>
                </div>

                <div class="text-center border-t pt-4">
                    <button @click="cancelLogin" class="text-gray-500 hover:text-gray-800 underline text-sm">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å / ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏∑‡πà‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </transition>

</div>

<script src="inventory.js"></script>
<script src="script.js"></script>
</body>
</html>